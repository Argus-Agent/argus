# 消息设计

## 服务端 -> 客户端 (CodeAgent -> Client)

所有消息通过 `message_to_client` 队列发送。

### 1. 状态更新 (Status)
用于通知客户端当前 Agent 的执行阶段。
格式: `{"name": "CodeAgent", "type": "status", "content": STATUS_CODE}`

- `[START]`: 任务开始
- `[STOP]`: 任务结束（完成或停止）
- `[BLOCK{i}]`: 开始执行第 i 个代码块 (例如 `[BLOCK0]`)

### 2. AI 内容流 (AI Content Stream)
用于实时显示 AI 的思考和回复过程。
格式: `{"name": "CodeAgent", "type": "ai_content", "content": CONTENT}`

- `[BEGIN]`: 开始生成内容
- `[END]`: 内容生成结束
- `...text...`: AI 生成的文本片段 (流式)

### 3. 请求 (Request)
用于向客户端请求权限或确认。
格式: `{"name": "CodeAgent", "type": "request", "content": REQUEST_TYPE}`

- `code_permission`: 请求执行代码权限

### 4. 代码执行输出 (Code Execution Output)
用于显示代码执行的结果。

- **文本输出**:
  `{"name": "CodeAgent", "type": "text", "content": "输出内容"}`
- **图片输出**:
  `{"name": "CodeAgent", "type": "image/png", "content": "base64_or_url", ...}` (具体字段取决于执行器返回)

## 客户端 -> 服务端 (Client -> CodeAgent)

客户端通过 `message_from_client` 队列发送指令。

### 1. 控制指令 (Control)
格式: `{"name": "CodeAgent", "type": "request", "content": COMMAND}`

- `stop_code`: 停止当前代码执行
- `stop_agent`: 停止 Agent 任务
- `approve`: 允许执行代码 (响应 `code_permission`)
- `deny`: 拒绝执行代码 (响应 `code_permission`)
